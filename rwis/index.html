<!DOCTYPE html>
<!-- template-v2015  -->
<!--[if lte IE 7]><html class="no-js old-ie lte-ie7" lang="en" dir="ltr"><![endif]-->
<!--[if lte IE 8]><html class="no-js old-ie lte-ie8 lte-ie7" lang="en" dir="ltr"><![endif]-->
<!--[if gt IE 8]><!--><html class="no-js" lang="en" dir="ltr"><!--<![endif]-->
<head>
  <!-- Head Content  -->
<meta charset="utf-8">

<!--[if gt IE 8 ]--><meta http-equiv="X-UA-Compatible" content="IE=Edge" /><!--<![endif]-->
<title>Lower Colorado River Operations | Lower Colorado Region | Bureau of Reclamation</title>
<meta name="Description" content="Bureau of Reclamation, Lower Colorado Region." />
<meta name="Keywords" content="Department of the Interior, Bureau of Reclamation, Lower Colorado Region, Lower Colorado River, Colorado River, Hoover Dam, Phoenix, Yuma, Temecula, Area Offices" />
<meta name="author" content="Bureau of Reclamation, Lower Colorado Region Web Team" />
<meta name="publisher" content="Bureau of Reclamation, Lower Colorado Region" />
<meta name="created" content="20150101" />
<meta name="expires" content="Never" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="shortcut icon" href="https://www.usbr.gov/img/favicon.ico">

<!-- Stylesheets for visualizations -->
<link rel="stylesheet" href="https://www.usbr.gov/css/main.min.css" />
<link rel="stylesheet" href="dygraph.css" />  
<link rel="stylesheet" href="leaflet.0.7.3.css"/>
<style>
    #map{ width: 400px; height: 500px; }
</style>

<!-- Modernizr -->
<script src="https://www.usbr.gov/js/lib/modernizr.js"></script>
  
</head>
<body>
  <div class="MainContainer">
    <!-- Skip Links (only visible to screen readers) -->
<div id="SkipLinks" class="SkipLinks">
  <ul>
    <li><a href="#Nav">Skip to Primary Navigation</a></li>
    <li><a href="#Main">Skip to Main Content</a></li>
    <li><a href="#Footer">Skip to Footer</a></li>
  </ul>
</div><!-- #BeginLibraryItem "library/topnav.lbi" --><!-- Header -->
<div class="Header" id="top" role="banner">
  <div class="Header-wrap container">

    <!-- Logo -->
    <a class="Header-logo" href="https://www.usbr.gov" title="Reclamation Home"><img src="https://www.usbr.gov/img/logo-white.png" alt="U.S. Bureau of Reclamation: Managing Water in the West"></a> 

     <div class="Header-social">
      <span class="Header-social-label">Share</span>
      <ul>
        <li>
          <a class="critical-icon" title="Share on Facebook" target="_blank" href="http://www.facebook.com/sharer.php?u={url}">
            <span class="icon-facebook" aria-hidden="true"></span>
            <span class="fallback">Facebook</span>
          </a>
        </li>
        <li>
          <a class="critical-icon" title="Share on Twitter" target="_blank" href="https://twitter.com/share?url={url}&text={title}&via={via}&hashtags={hashtags}">
            <span class="icon-twitter" aria-hidden="true"></span>
            <span class="fallback">Twitter</span>
          </a>
        </li>
        <li>
          <a class="critical-icon" title="Share on Tumblr" target="_blank" href="http://www.tumblr.com/share/link?url={url}&name={title}&description={desc}">
            <span class="icon-tumblr" aria-hidden="true"></span>
            <span class="fallback">Tumblr</span>
          </a>
        </li>
        <li>
          <a class="critical-icon" title="Share on Pinterest" target="_blank" href="https://pinterest.com/pin/create/bookmarklet/?media={img}&url={url}&is_video={is_video}&description={title}">
            <span class="icon-pinterest" aria-hidden="true"></span>
            <span class="fallback">Pinterest</span>
          </a>
        </li>
      </ul>
    </div><!-- end Header-social -->

  </div><!-- end container -->
</div><!-- end Header -->

<!-- Nav Menu -->
<div class="Nav" id="Nav">
  <div class="Nav-wrap">
    <!-- Navigation -->
    <ol class="Nav-list resetList" role="navigation" aria-label="Primary Navigation">
      <li class="Nav-item">
        <a class="Nav-item-link" href="#">Water &amp; Power</a>
        <ol class="Nav-sublist resetList" aria-label="submenu">
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/projects/dams.jsp" class="Nav-sublist-link">Dams</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/projects/powerplants.jsp" class="Nav-sublist-link">Powerplants</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/projects/projects.jsp" class="Nav-sublist-link">Projects</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/agrihydro.html" class="Nav-sublist-link">Agrimet/Hydromet</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/water/" class="Nav-sublist-link">Water Operations</a></li>
         </ol>
      </li>
      <li class="Nav-item">
        <a class="Nav-item-link" href="#">Resources &amp; Research</a>
        <ol class="Nav-sublist resetList" aria-label="submenu">
           <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/programs/" class="Nav-sublist-link">Programs</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/tsc/" class="Nav-sublist-link">Technical Service Center</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/research/" class="Nav-sublist-link">Research &amp; Development</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/recman/" class="Nav-sublist-link">Reclamation Manual</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/environmental/" class="Nav-sublist-link">Environmental Resources/Reports</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/library/" class="Nav-sublist-link">Library</a></li>
        </ol>
      </li>
      <li class="Nav-item">
        <a class="Nav-item-link" href="#">About Us</a>
        <ol class="Nav-sublist resetList" aria-label="submenu">
          <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/about/mission.html" class="Nav-sublist-link">Mission/Vision</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/about/fact.html" class="Nav-sublist-link">Fact Sheet</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/presskit/bios/biosdetail.cfm?recordid=1" class="Nav-sublist-link">Commissioner</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/offices.html" class="Nav-sublist-link">Addresses/Contacts</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/images/br_org_chart.pdf" class="Nav-sublist-link">Organizational Chart</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/presskit/bios/bios.cfm" class="Nav-sublist-link">Leadership Bios</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/hr/" class="Nav-sublist-link">Employment</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/comments.cfm/" class="Nav-sublist-link">Contact</a></li>
        </ol>
      </li>
      <li class="Nav-item">
        <a class="Nav-item-link" href="#">Recreation &amp; Public Use</a>
        <ol class="Nav-sublist resetList" aria-label="submenu">
          <li class="Nav-sublist-item"><a href="https://www.usbr.gov/recreation/" class="Nav-sublist-link">Find Recreation</a></li>
         <li class="Nav-sublist-item"><a href="http://www.recreation.gov/" class="Nav-sublist-link">Recreation.gov</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/lands/" class="Nav-sublist-link">Public Use</a></li>
        </ol>
      </li>
      <li class="Nav-item">
        <a class="Nav-item-link" href="#">News &amp; Multimedia</a>
        <ol class="Nav-sublist resetList" aria-label="submenu">
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/newsrelease/" class="Nav-sublist-link">News Releases</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/stories/" class="Nav-sublist-link">News Stories</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/speech/" class="Nav-sublist-link">Speeches</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/testimony/" class="Nav-sublist-link">Congressional Testimony</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/newsroom/presskit/factsheet/" class="Nav-sublist-link">Fact Sheets</a></li>
                  <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/multimedia/index.html#photos" class="Nav-sublist-link">Photos</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/multimedia/index.html#video" class="Nav-sublist-link">Multimedia</a></li>
         <li class="Nav-sublist-item"><a href="https://www.usbr.gov/main/multimedia/index.html#social" class="Nav-sublist-link">Social Media</a></li>
        </ol>
      </li>
    </ol>

    <!-- Search -->
    <div class="Header-search" id="recSearch">
       <form method="get" action=" http://search.usa.gov/search" role="search">
        <input type="hidden" name="affiliate" value="Reclamation" />
        <label class="visuallyhidden" for="query">Search</label>
        <input type="text" name="query" id="query" placeholder="Search" />
        <button type="submit" id="search">Search</button>
      </form>
    </div>
  </div>
</div><!-- #EndLibraryItem --><!-- Update inline style to change banner image -->
<div class="Main" id="Main" role="main" style="background-image: url('https://www.usbr.gov/img/bg-banner.jpg')">
      <!-- Additional wrapper for bottom background image -->
      <div class="Main-wrap" style="background-image: url('https://www.usbr.gov/img/bg-footer.jpg')">
        <!-- Banner -->
        <div class="Banner Banner--full">
          <div class="Banner-content">
            <div class="container">
              <h1>RWIS Data Service Test</h1>
           
            </div>
          </div>
        </div><!-- end Banner -->

        <div class="Main-content container">
          <!-- Breadcrumbs -->
<div class="Breadcrumbs">
  <div class="container">
    <ul class="resetList">
    <li><a href="https://www.usbr.gov">Reclamation Home</a></li>      
    </ul>
  </div>
</div>

<div class="Main-well">
            <div align="left">
              <table border="0" cellpadding="2" cellspacing="10" width="100%">
                <tbody>
                  <tr bgcolor="ffffff" align="left">
<br>				  

<!-- MAIN CONTENT GOES HERE -->

<strong>TEST PAGE POINTING TO RWIS<br><br>
This page is generated with data from <a href="https://water.usbr.gov/api/web/app.php/api/series?sites=hdmlc&parameters=Day.Inst.ReservoirElevation.feet&start=2017-01-01&end=2017-04-28">this</a> RWIS link to JSON data.
<br><br>
If the visualizations below do not show up after a few seconds, try reloading the page since the RWIS data feed is flaky...
<br><br>

	<tr bgcolor="ffffff" align="left">
	
		<td width="50%" valign="top">
		<strong>Data Plot:</strong>
		<br><br>
		<div id="graphdiv1"></div>
		<br><br>
		</td>
		
		<td width="50%" valign="top">
		<strong>Fill Gauge: (based on data but % shown is non-sensical)</strong>
		<br><br><br><br>
		<svg id="fillgauge1" width="97%" height="250"></svg>
		<br><br>
		</td>
		
	</tr>
	
	<tr bgcolor="ffffff" align="left">
	
		<td width="50%" valign="top">
		<strong>Partial JSON Content:</strong>
		<blockquote>
		Name: <blockquote><div id="jsonName"></div>
		</blockquote></blockquote>
		<blockquote>
		Type: <blockquote><div id="jsonType"></div>
		</blockquote></blockquote>
		<blockquote>
		Data: <blockquote><div id="jsonData"></div>
		</blockquote></blockquote>
		</td>
	
		<td width="50%" valign="top">
		<strong>Mapping:</strong>
		<br><br>
		<div id="mapLatLon"></div>
		<div id="map"></div>
		</td>
	
	</tr>



	
                </tr>
                </tbody>
              </table>
            </div>
		</div><!-- end Main-well -->
	</div><!-- end Main-content -->    
</div><!-- end Main-wrap -->
</div><!-- end Main -->

<div><!-- #BeginLibraryItem "/library/footer.lbi" -->
<!-- Footer -->
<div class="Footer" id="Footer" role="contentinfo">
  <div class="container">

    <h2 class="visuallyhidden">More Information about the U.S. Bureau of Reclamation</h2>

    <!-- Social Links -->
    <div class="Footer-social">
      <h2>Stay in Touch</h2>
      <ul>
        <li>
          <a href="http://www.facebook.com/bureau.of.reclamation" target="new" class="critical-icon">
            <span class="icon-facebook" aria-hidden="true"></span>
            <span class="fallback">Facebook</span>
          </a>
        </li>
        <li>
          <a href="http://twitter.com/usbr" class="critical-icon" target="new">
            <span class="icon-twitter" aria-hidden="true"></span>
            <span class="fallback">Twitter</span>
          </a>
        </li>
        <li>
          <a href="http://www.youtube.com/user/reclamation" class="critical-icon" target="new">
            <span class="icon-youtube" aria-hidden="true"></span>
            <span class="fallback">YouTube</span>
          </a>
        </li>
        <li>
          <a href="http://www.flickr.com/photos/usbr/" class="critical-icon" target="new">
            <span class="icon-flickr" aria-hidden="true"></span>
            <span class="fallback">Flickr</span>
          </a>
        </li>
        <li>
          <a href="http://usbr.tumblr.com/" class="critical-icon" target="new">
            <span class="icon-tumblr" aria-hidden="true"></span>
            <span class="fallback">Tumblr</span>
          </a>
        </li>
        <li>
          <a href="http://www.pinterest.com/usbrgov/" class="critical-icon" target="new">
            <span class="icon-pinterest" aria-hidden="true"></span>
            <span class="fallback">Pinterest</span>
          </a>
        </li>
        <li>
          <a href="http://instagram.com/bureau_of_reclamation" class="critical-icon" target="new">
            <span class="icon-instagram" aria-hidden="true"></span>
            <span class="fallback">Instagram</span>
          </a>
        </li>
        <li>
          <a href="https://www.usbr.gov/newsroom/rssxml/rssfeeds.html" class="critical-icon" target="new">
            <span class="icon-rss" aria-hidden="true"></span>
            <span class="fallback">RSS</span>
          </a>
        </li>
      </ul>
    </div>

    <!-- Site Links -->
    <div class="Footer-links">
      <ul>
        <li><a href="https://www.usbr.gov/main/comments.cfm">Contact Us</a></li>
        <li><a href="https://www.usbr.gov/main/index/">Site Index</a></li>
      </ul>
      <ul>
        <li><a href="https://www.usbr.gov/main/access.html">Accessibility</a></li>
        <li><a href="https://www.usbr.gov/main/disclaimer.html">Disclaimer</a></li>
        <li><a href="http://www.doi.gov/" target="new"><abbr title="Department of the Interior">DOI</abbr></a></li>
       
        <li><a href="https://www.usbr.gov/foia/">FOIA</a></li>
        <li><a href="http://www.doi.gov/pmb/eeo/no-fear-act.cfm">No Fear Act</a></li>
        <li><a href="https://www.usbr.gov/main/notices.html">Notices</a></li>
         <li><a href="https://www.usbr.gov/main/privacy.html">Privacy Policy</a></li>
        <li><a href="https://www.usbr.gov/main/qoi/">Quality of Information</a></li>
        <li><a href="http://www.recreation.gov/" target="new">Recreation.gov</a></li>
        <li><a href="http://www.usa.gov/" target="new">USA.gov</a></li>
       
      </ul>
    </div>
    

    <!-- Logo -->
    <a class="Footer-logo" href="https://www.usbr.gov"><img src="https://www.usbr.gov/img/seal-white.png" alt="U.S. Department of the Interior-Bureau of Reclamation"></a>

  </div>
</div>

 <!-- #EndLibraryItem --></div> 

 <!-- JS libraries for visualizations -->
<script src="https://www.usbr.gov/js/lib/jquery.js"></script>
<script src="d3.v3.min.js" language="JavaScript"></script>
<script src="dygraph.min.js"></script>
<script src="liquidFillGauge.js"></script>
<script src="leaflet.0.7.3.js"></script>

<!-- JS for generating visualizations -->
<script>
// Only load FastClick if touch events are supported
if ( Modernizr.touch ) {
  $(function() {
    $.getScript("https://www.usbr.gov/js/lib/fastclick.min.js", function() {
      FastClick.attach(document.body);
    });
  });
}
// Function to fetch RWIS JSON output
var getJSON = function(url) {
  return new Promise(function(resolve, reject) {
    var xhr = new XMLHttpRequest();
    xhr.open('get', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        resolve(xhr.response);
      } else {
        reject(status);
      }
    };
    xhr.send();
  });
};
// Replace-All function for working with strings
String.prototype.replaceAll = function(search, replace) {
    if (replace === undefined) {
        return this.toString();
    }
    return this.split(search).join(replace);
}
// Main script that does all the work
getJSON('https://water.usbr.gov/api/web/app.php/api/series?sites=hdmlc&parameters=Day.Inst.ReservoirElevation.feet&start=2017-01-01&end=2017-04-28').then(function(data) {
    //alert('Your Json result is:  ' + JSON.stringify(data["Lake Mead"], null, 4));  
	
	// ACCESSING JSON OUTPUTS WITH JS
	jsonName.innerText = JSON.stringify(data["Lake Mead"].description, null, 4);
	jsonType.innerText = JSON.stringify(data["Lake Mead"].type, null, 4);
	jsonData.innerText = JSON.stringify(data["Lake Mead"].parameters["Day.Inst.ReservoirElevation.feet"]["timeinterval"]["Daily"][0], null, 4) + "," + 
						JSON.stringify(data["Lake Mead"].parameters["Day.Inst.ReservoirElevation.feet"]["timeinterval"]["Daily"][1], null, 4) + ", ..., " + 
						JSON.stringify(data["Lake Mead"].parameters["Day.Inst.ReservoirElevation.feet"]["timeinterval"]["Daily"][
							data["Lake Mead"].parameters["Day.Inst.ReservoirElevation.feet"]["timeinterval"]["Daily"].length - 1
						], null, 4);
	
	// TIMESERIES CHART USING DYGRAPHS
	var graphData = JSON.stringify(data["Lake Mead"].parameters["Day.Inst.ReservoirElevation.feet"]["timeinterval"]["Daily"], null, 2);
			//[ RWIS OUTPUT
			//  {
			//    "datetime": "2010-01-01 00:00:00",
			//    "value": "11169400",
			//    "flag": ""
			//  },...
			//]
			// REQUIRED INPUT
           //[
           //  [1,10,100],
           //  [2,20,80],
           //  [3,50,60],
           //  [4,70,80]
           //],	
    // Transform JSON string to DyGraph input...
	graphData = graphData.replaceAll(/,\r?\n|\r/g, ", ");
	graphData = graphData.replaceAll(/[\}],\s+[\{]\r?\n/g, "");
	graphData = graphData.replaceAll(/[\{]\r?\n|\r/g, "");
	graphData = graphData.replaceAll(/[\}]\r?\n|\r/g, "");
	graphData = graphData.replaceAll(/,\s+0/g, ", 0],");
	graphData = graphData.replaceAll("\"datetime\": ", "  [ ");
	graphData = graphData.replaceAll("\"value\": ", " ");
	graphData = graphData.replaceAll(/\s+00:00:00[\"],\s+[\"]/g, "\", ");
	graphData = graphData.replaceAll(/[\"],\s+[\"]/g, "\"), ");
	graphData = graphData.replaceAll("-","/");
	graphData = graphData.replaceAll("\"), flag\": \"\""," ],");
	graphData = graphData.replaceAll(/[\]],\r\n[\]]/g, "");
	graphData = graphData.slice(0, graphData.length - 5) + graphData.slice(graphData.length - 4);
	new Dygraph(document.getElementById("graphdiv1"),
				graphData, 
				{ 	
					labels: [ "Date", "Value", "B" ],
					ylabel: 'Value',
					fillGraph: true,
					color: '#244A9F',
					highlightCircleSize: 5, 
					pointSize: 1.5, 
					strokeWidth: 1.5

				}
			 );
	
	// FILL GAUGE USING D3
	var fillVal = JSON.stringify(data["Lake Mead"].parameters["Day.Inst.ReservoirElevation.feet"]["timeinterval"]["Daily"][0].value, null, 4).replaceAll("\"","");
	var config1 = liquidFillGaugeDefaultSettings();
    config1.circleColor = "#244A9F";
    config1.textColor = "#CB9F5B";
    config1.waveTextColor = "#CB9F5B";
    config1.waveColor = "#244A9F";
    config1.circleThickness = 0.2;
    config1.textVertPosition = 0.2;
    config1.waveAnimateTime = 1000;
    var gauge1 = loadLiquidFillGauge("fillgauge1", Math.floor(fillVal/15), config1);
	
	// MAPPING EXAMPLE USING LEAFLET
	var dataLat = JSON.stringify(data["Lake Mead"].latitude, null, 4).replaceAll("\"","");
	var dataLon = JSON.stringify(data["Lake Mead"].longitude, null, 4).replaceAll("\"","");
	mapLatLon.innerText = "JSON coordinates: " + dataLat + ", " + dataLon;
	// initialize the map
	var map = L.map('map').setView([dataLat, dataLon], 13);	
	// load a tile layer
	L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
	{
		attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
		maxZoom: 19,
		minZoom: 9
	}).addTo(map);
	var marker = L.marker([dataLat, dataLon]).addTo(map);
	marker.bindPopup(dataLat + ", " + dataLon).openPopup();
}, function(status) { //error detection....
  alert('Something went wrong.');
});  
</script>
   
<!-- Outlines -->
<script src="https://www.usbr.gov/js/components/outlines.js"></script>

<!-- Mobile Navigation -->
<script src="https://www.usbr.gov/js/components/navigation.js"></script>

<!-- Responsive Tabs -->
<script src="https://www.usbr.gov/js/lib/responsive-tabs.js"></script>
<script src="https://www.usbr.gov/js/components/tabs.js"></script>

<!-- Explore Accordion -->
<script src="https://www.usbr.gov/js/components/explore.js"></script>

<!-- Carousel -->
<script src="https://www.usbr.gov/js/lib/carousel.js"></script>
<script src="https://www.usbr.gov/js/components/carousel.js"></script>

<!-- Left Navigation -->
<script src="https://www.usbr.gov/js/components/left-nav.js"></script>

</body>
</html>